# Loja de produtos medievais

# Contexto
API de uma loja de produtos medievais onde o usu√°rio logado consegue listar e cadastrar produtos e vendas

## Tecnologias usadas

> NodeJS, Typescript, ExpressJS, JWT, MySQL, Docker


## Clonando o projeto


```bash
git@github.com:joyceandronico/loja-de-produtos-medievais-API.git
```
* Acessando a pasta do projeto:

```bash
cd loja-de-produtos-medievais-API
```

## Executando a aplica√ß√£o

* Com Docker:

  ```
  docker-compose up
  ```

  * Acesse o container da aplica√ß√£o:

  ```
  docker exec -it loja-medieval bash
  ```

  * Instale as depend√™ncias:

  ```
  npm install
  ```


* Localmente:

  * Vari√°veis de Ambiente

Na raiz do projeto, crie um arquivo .env para configurar as vari√°veis de ambiente. Por exemplo, caso o seu usu√°rio SQL seja `nome` e senha `1234`, o arquivo ficar√° desta forma:

```bash
MYSQL_HOST=localhost
MYSQL_USER=nome
MYSQL_PASSWORD=1234
```

  * Instale as depend√™ncias:

  ```
  npm install
  ```

  * Recrie a base de dados usando MySQL Workbench ou programa semelhante (arquivo loja_medieval.sql)

  * Inicie a aplica√ß√£o:

  ```
  npm start
  ```

# Endpoints

## Endpoint para o cadastro de produtos

- O endpoint ser√° acess√≠vel atrav√©s do caminho (`/products`);

<details close>

  <br>

- Os produtos enviados ser√£o salvos na tabela `Products` do banco de dados;

- O endpoint deve receber a seguinte estrutura:
```json
  {
    "name": "Espada longa",
    "amount": "30 pe√ßas de ouro"
  }
```

---

## Endpoint para a listagem de produtos

- O endpoint ser√° acess√≠vel atrav√©s do caminho (`/products`);

<details close>

  <br>

  > üëâ Para caso os dados sejam enviados corretamente

  - O resultado retornado para listar produtos com sucesso dever√° ser conforme exibido abaixo, com um _status http_ `200`:
    ```json
    [
      {
        "id": 1,
        "name": "Po√ß√£o de cura",
        "amount": "20 gold",
        "orderId": null
      },
      {
        "id": 2,
        "name": "Escudo do Her√≥i",
        "amount": "100 diamond",
        "orderId": 1
      }
    ]
    ```
</details>

---

## Endpoint para o cadastro de pessoas usu√°rias

- O endpoint ser√° acess√≠vel atrav√©s do caminho (`/users`);

- As informa√ß√µes de pessoas usu√°rias cadastradas ser√£o salvas na tabela `Users` do banco de dados;

- O endpoint deve receber a seguinte estrutura:
```json
{
  "username": "MAX",
  "classe": "swordsman",
  "level": 10,
  "password": "SavingPeople"
}
```

<details close>

  > üëâ Para caso os dados sejam enviados corretamente

  - Se a pessoa usu√°ria for cadastrada com sucesso, o resultado dever√° ser conforme o exibido abaixo, com um _status http_ `201` e retornando um _token_:
    ```json

  {
	"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7ImlkIjozLCJ1c2VybmFtZSI6InlyYWEifSwiaWF0IjoxNjY1ODg3NTExLCJleHAiOjE2NjY0OTIzMTF9.oDRUJtVKzCrYUnjELNa1Pj58VeB_JVVzMPe63xRBBAk"
  }
    ```
</details>

---

## Endpoint para listar todos os pedidos

- O endpoint ser√° acess√≠vel atrav√©s do caminho (`/orders`).
- Essa rota retorna todos os pedidos e os `id`s dos produtos associados a estes.

<details close>

  <br>

  > üëâ Para orders

   - Quando houver mais de um pedido, o resultado retornado para listar pedidos com sucesso dever√° ser conforme exibido abaixo, com um _status http_ `200`:
    ```json
      [
        {
          "id": 1,
          "userId": 2,
          "productsIds": [1, 2]
        },
        {
          "id": 2,
          "userId": 2,
          "productsIds": [3, 4]
        }
      ]
    ```
</details>

---


## Endpoint para o login de pessoas usu√°rias

- O endpoint ser√° acess√≠vel atrav√©s do caminho (`/login`).

- A rota deve receber os campos `username` e `password`, e esses campos ser√£o validados no banco de dados.

- Um token `JWT` deve ser gerado e retornado caso haja sucesso no _login_. No seu _payload_ deve estar presente o _id_ e _username_.

- O endpoint deve receber a seguinte estrutura:
```json
  {
    "username": "string",
    "password": "string"
  }
```

<details close>


  <br>

  > üëâ Para caso haja problemas no login

  - Se o _login_ n√£o tiver o campo "username", o resultado retornado dever√° ser um _status http_ `400` e
    ```json
      { "message": "\"username\" is required" }
    ```


  - Se o _login_ n√£o tiver o campo "password", o resultado retornado dever√° ser um _status http_ `400`
    ```json
      { "message": "\"password\" is required" }
    ```


  - Se o _login_ tiver o username inv√°lido, o resultado retornado dever√° ser um _status http_ `401` e
    ```json
      { "message": "Username or password invalid" }
    ```


  - Se o login tiver a senha inv√°lida, o resultado retornado dever√° ser um _status http_ `401` e
    ```json
      { "message": "Username or password invalid" }
    ```

  <br>

  > üëâ Para caso os dados sejam enviados corretamente

  - Se o login foi feito com sucesso, o resultado dever√° ser um _status http_ `200` e dever√° retornar um _token_:
    ```json

  {
	"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7ImlkIjozLCJ1c2VybmFtZSI6InlyYWEifSwiaWF0IjoxNjY1ODg3NTExLCJleHAiOjE2NjY0OTIzMTF9.oDRUJtVKzCrYUnjELNa1Pj58VeB_JVVzMPe63xRBBAk"
  }
    ```
</details>

---

## Valida√ß√µes dos produtos


<details close>


  <br>

  > üëâ Para name

  - Se o campo "name" n√£o for informado, o resultado retornado dever√° ser um  _status http_ `400` e
    ```json
      { "message": "\"name\" is required" }
    ```


  - Se o campo "name" n√£o for do tipo `string`, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"name\" must be a string" }
    ```


  - Se o campo "name" n√£o for uma string com mais de 2 caracteres, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"name\" length must be at least 3 characters long" }
    ```

  <br>

  > üëâ Para amount

  - Se o campo "amount" n√£o for informado, o resultado retornado dever√° ser um _status http_ `400` e
    ```json
      { "message": "\"amount\" is required" }
    ```


  - Se o campo "amount" n√£o for do tipo `string`, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"amount\" must be a string" }
    ```


  - Se o campo "amount" n√£o for uma string com mais de 2 caracteres, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"amount\" length must be at least 3 characters long" }
    ```

  <br>

</details>


---

## Valida√ß√µes para as pessoas usu√°rias


<details close>
  <summary>As seguintes valida√ß√µes ser√£o ser realizadas:</summary>

  <br>

  > üëâ Para username

  - Se a requisi√ß√£o n√£o tiver o campo "username", o resultado retornado dever√° ser um _status http_ `400` e
    ```json
      { "message": "\"username\" is required" }
    ```


  - Se o campo "username" n√£o for do tipo `string`, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"username\" must be a string" }
    ```


  - Se o campo "username" n√£o for do tipo `string` com mais de 2 caracteres, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"username\" length must be at least 3 characters long" }
    ```

  <br>

  > üëâ Para classe

  - Se a requisi√ß√£o n√£o tiver o campo "classe", o resultado retornado dever√° ser um _status http_ `400` e
    ```json
      { "message": "\"classe\" is required" }
    ```


  - Se o campo "classe" n√£o for do tipo `string`, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"classe\" must be a string" }
    ```


  - Se o campo "classe" n√£o for do tipo `string` com mais de 2 caracteres, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"classe\" length must be at least 3 characters long" }
    ```

  <br>

  > üëâ Para level

  - Se a pessoa usu√°ria n√£o tiver o campo "level", o resultado retornado dever√° ser um _status http_ `400` e
    ```json
      { "message": "\"level\" is required" }
    ```


  - Se o campo "level" n√£o for do tipo `number`, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"level\" must be a number" }
    ```


  - Se o campo "level" n√£o for do tipo `number` maior que 0, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"level\" must be greater than or equal to 1" }
    ```

  <br>

  > üëâ Para password

  - Se a requisi√ß√£o n√£o tiver o campo "password", o resultado retornado dever√° ser um _status http_ `400` e
    ```json
      { "message": "\"password\" is required" }
    ```


  - Se o campo "password" n√£o for do tipo `string`, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"password\" must be a string" }
    ```


  - Se o campo "password" n√£o for do tipo `string` com mais de 8 caracteres, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"password\" length must be at least 8 characters long" }
    ```

  <br>

</details>

---

## 8 - Crie um endpoint para o cadastro de um pedido

- O endpoint ser√° acess√≠vel atrav√©s do caminho (`/orders`);

- Um pedido s√≥ pode ser criado caso a pessoa usu√°ria esteja logada e o token `JWT` validado;

- Os pedidos enviados devem ser salvos na tabela `Orders` do banco de dados, salvando `id` da pessoa usu√°ria da aplica√ß√£o que fez esse pedido.

- A tabela `Products` tamb√©m deve ser alterada, atualizando todos os produtos com os `id` inclu√≠dos na chave `productsIds` da requisi√ß√£o, e adicionando nesses produtos o `orderId` do pedido rec√©m criado;

- O endpoint deve receber a seguinte estrutura:
```json
  {
    "productsIds": [1, 2]
  }
```


<details close>

  <br>

  > üëâ Para token

  - Se o token n√£o for informado, o resultado retornado dever√° ser um _status http_ `401` e
    ```json
      { "message": "Token not found" }
    ```


  - Se o token informado n√£o for v√°lido, o resultado retornado dever√° ser um _status http_ `401` e
    ```json
      { "message": "Invalid token" }
    ```

  <br>

  > üëâ Para products

  - Se o corpo da requisi√ß√£o n√£o possuir o campo "productsIds", o resultado retornado dever√° ser um _status http_ `400` e
    ```json
      { "message": "\"productsIds\" is required" }
    ```


  - Se o valor do campo "productsIds" n√£o for um array, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"productsIds\" must be an array" }
    ```


  - Se o campo "productsIds" possuir um array vazio, o resultado retornado dever√° ser um _status http_ `422` e
    ```json
      { "message": "\"productsIds\" must include only numbers" }
    ```

  <br>

  > üëâ Para caso os dados sejam enviados corretamente

  - O resultado retornado para cadastrar um pedido com sucesso dever√° ser conforme exibido abaixo, com um _status http_ `201`:
    ```json
      {
        "userId": 1,
        "productsIds": [1],
      }
    ```

  - O resultado retornado para cadastrar um pedido com sucesso dever√° ser conforme exibido abaixo, com um _status http_ `201`:
    ```json
      {
        "userId": 1,
        "productsIds": [1, 2]
      }
    ```
</details>

---
